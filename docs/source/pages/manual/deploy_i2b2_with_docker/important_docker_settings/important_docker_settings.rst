
***********************************
Dockerの重要な設定について
***********************************

.. figure:: /_static/images/common_images/docker_logos/docker-logo-blue.svg
   :alt: Docker Logo
   :width: 400px
   :align: left

| Dockerの設定は複雑なので、全てはここでカバーできませんが、i2b2サーバーの実装にあたって確認が望ましい項目があります。このページでは、特に重要な設定について説明します。


1. Dockerの利用に伴うルートパーティションの枯渇リスク
---------------------------------------------------

| Dockerはデフォルトではimageおよびvolumeなどのデータをルートパーティションに保存します。i2b2に特有のことではなく、一般的にこれらのデータは通常かなり大きな容量になるため、得に対策をしないとルートパーティションが枯渇してシステムの重大な障害を引き起こす可能性があります。
| i2b2サーバーでは、Postgresのデータベースが大きくなる可能性があるため、特に注意が必要です。以下のいずれかの対策を強くお勧めします。

1.1 Dockerのdata-rootを変更する
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

| Dockerは `data-root` と呼ばれるパスにimageやvolumeなどのデータを保存します。デフォルトでは `/var/lib/docker` ですが、これを別のパーティションに変更することで、ルートパーティションの枯渇を防ぐことができます。
| 例えば、Dockerの設定ファイル `/etc/docker/daemon.json` に以下のように記述して、data-rootを変更できます:

   .. code-block:: json

      {
        "data-root": "/path/to/your/docker_data"
      }

| 詳細は、Dockerの公式ドキュメントを参照してください。

1.2 Postgresのデータを保存するDockerボリュームを別のパーティションにマウントする
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

| i2b2サーバーでは、Postgresのデータベースが大きくなる可能性があります。Postgresのデータを保存するDockerボリュームを別のパーティションにマウントすることで、ルートパーティションの枯渇を防ぐことができます。
    